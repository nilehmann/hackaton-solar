<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
        <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <script src="//d3js.org/d3.v3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore.js" integrity="sha256-SzKOQsVYGX1bmddyfPzGC6yXY/rWYGUSMOi6+T9gZ+0=" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/9.1.0/nouislider.min.css" integrity="sha256-6lKtZVw8FGSeajkIjeEpbRwGZOLye985T3xtQnop8U8=" crossorigin="anonymous" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/9.1.0/nouislider.min.js" integrity="sha256-pgtwAvd29sOS5oI19zN+/gr1NIdgj27HC7PNUG9o41M=" crossorigin="anonymous"></script>

        <!--<script src="http://www.prtctransit.org/css/jquery-ui-1.10.3.custom/js/jquery-ui-1.10.3.custom.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jQRangeSlider/5.7.2/jQDateRangeSlider.min.js" integrity="sha256-r6uyRzKiDUhc0mfN99ZIOLFNdIYOS/cfiLv8R0YArvo=" crossorigin="anonymous"></script>-->

        <script type="text/javascript" src="plotly_test.js"></script>
        <link rel="stylesheet" href="main.css" />
        <title>Maps</title>
    </head>
    <body>
        <div id="range-slider"></div>
        <div id="main-map"></div>
        <div id="graphs">
            <div id="left-graph"></div>
            <div id="right-graph"></div>
        </div>

        <script>
            var southWest = L.latLng(-90, -180);
            var northEast = L.latLng(90, 180);
            var bounds = L.latLngBounds(southWest, northEast);
            var myMap = L.map('main-map', {
               center:[-33.606849999999994,-70.73545],
               zoom: 4,
               maxZoom: 9,
               maxBounds: bounds,
               layers: [],
               crs: L.CRS.EPSG3857
             });
            var tileLayer = L.tileLayer(
                'https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png',
                {
                    maxZoom: 18,
                    minZoom: 1,
                    attribution: '(c) <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors (c) <a href="http://cartodb.com/attributions">CartoDB</a>, CartoDB <a href ="http://cartodb.com/attributions">attributions</a>',
                    detectRetina: false
                    }
                ).addTo(myMap);
            Plotly.d3.csv('centrales-solares.csv', function(err, rows){
                function unpack(rows, key) {
                    return rows.map(function(row) { return row[key]; });
                }
                var rowsFiltered = rows.filter(function(row) {
                    //console.log(row);
                    var marker = L.marker([parseFloat(row.Latitude), parseFloat(row.Longitude)]).addTo(myMap);
                    marker.bindPopup("CENTRAL "+row.Nombre+"<br>"+row.Regi√≥n+"<br>COMUNA:"+row.Comuna).openPopup();
                    return true;
                });
            });
        </script>

        <script>
            const data = [
                {'radiation': 1000, 'date': '31/12/99', 'hour': '10'},
                {'radiation': 2000, 'date': '01/01/00', 'hour': '10'},
                {'radiation': 3000, 'date': '01/10/16', 'hour': '12'},
                {'radiation': 9999, 'date': '13/07/89', 'hour': '12'}
            ];

            //left_graph(data, '01/01/90', '31/12/16', $('#left-graph')[0]);
        </script>
    </body>
</html>